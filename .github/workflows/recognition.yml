name: Contributor Recognition
on:
  pull_request:
    types: [closed]

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  appreciate-contributor:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pull-requests: write
      issues: write
      
    steps:
      - name: Craft Personalized Thank You
        uses: actions/github-script@v7
        with:
          # Explicitly set the token
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const prUser = context.payload.pull_request.user.login;
            const prNumber = context.payload.pull_request.number;
            const additions = context.payload.pull_request.additions;
            const deletions = context.payload.pull_request.deletions;
            const contributionEmojis = ['ðŸŒŸ', 'ðŸš€', 'ðŸ’¡', 'ðŸ”§', 'âœ¨'];
            const randomEmoji = contributionEmojis[Math.floor(Math.random() * contributionEmojis.length)];
            
            try {
              await github.rest.issues.createComment({
                ...context.repo,
                issue_number: prNumber,
                body: `### ðŸ™Œ Contribution Celebrated ${randomEmoji}

                Hello @${prUser}, 

                Your pull request #${prNumber} has been merged! ðŸŽ‰

                **Impact Snapshot:**
                - Lines added: ${additions}
                - Lines deleted: ${deletions}

                Thank you so much for your contribution to Gocheerio! We've successfully merged your pull request, and your changes will be included in the upcoming release. 

                We really appreciate the effort and time you've put into this. Your work is helping to improve the project, and we're excited to see it evolve with your help. ðŸš€

                Your attention to detail and commitment to improving the project doesn't go unnoticed. Each contribution, no matter the size, helps push our community forward.

                Please don't hesitate to contribute again in the future â€“ there are always more ways to get involved!

                Keep innovating, keep contributing! ðŸ’ª`
              });
            } catch (error) {
              console.error('Error posting comment:', error);
              throw error;
            }
